<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping
    PUBLIC "-//Hibernate/Hibernate Mapping DTD//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>

    <class
        name="org.sakaiproject.component.app.syllabus.SyllabusTemplateImpl"
        table="SAKAI_SYLLABUS_TEMPLATE" optimistic-lock="version">

        <!-- A 36 hex character is our surrogate key.  -->
        <id name="surrogateKey" type="long">
            <column name="id" not-null="true" length="19" />
            <generator class="native">
                <param name="sequence">SyllabusTemplateImpl_SEQ</param>
            </generator>
        </id>
        
        <version name="lockId" />
        
        <property name="userId">
            <column name="userId" unique-key="uniqueSyllabusTemplate" length="36"
                not-null="true" index="syllabus_template_userId" />
        </property>       

        <property name="contextId">
            <column name="contextId" unique-key="uniqueSyllabusTemplate" length="255"
                not-null="true" index="syllabus_template_contextId" />
        </property>

        <property name="title">
            <column name="title" not-null="true" length="512"/>
        </property>
        
        <property name="content">
            <column name="content" not-null="false" length="5000"/>
        </property>

        <set name="syllabi_template" lazy="true" sort="natural"
             order-by="position_c asc" cascade="all-delete-orphan">
            <key column="surrogateKey"/>                        
            <one-to-many class="org.sakaiproject.component.app.syllabus.SyllabusTemplateImpl"/>            
        </set>                
        

    </class>
    
    <query name="findSyllabusTemplateByUserAndContextIds">
        <![CDATA[from org.sakaiproject.component.app.syllabus.SyllabusTemplateImpl as item where item.userId = :userId and item.contextId = :contextId]]>
    </query>    
    
    <query name="findSyllabusTemplateByContextId">
        <![CDATA[from org.sakaiproject.component.app.syllabus.SyllabusTemplateImpl as item where item.contextId = :contextId]]>
    </query>    

    <query name="findLargestSyllabusTemplatePosition">
        <![CDATA[select max(item.position) from org.sakaiproject.component.app.syllabus.SyllabusTemplateImpl as item where item.syllabusTemplate = :foreignKey]]>
    </query>

</hibernate-mapping>
